<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alcon MLR Pre-Screening Agent – Review</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --alcon-blue:#0072CE;
      --alcon-blue-600:#035bb0;
      --bg:#F6F8FB;
      --text:#1F2937;
      --muted:#6B7280;
      --card:#FFFFFF;
      --border:#E5E7EB;
      --shadow:0 10px 20px rgba(16,24,40,.06),0 2px 6px rgba(16,24,40,.06);
      --green:#12B76A;
      --amber:#FEC84B;
      --red:#D92D20;
      --teal:#2DD4BF;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    /* Top bar */
    .topbar{
      background:var(--card);
      border-bottom:1px solid var(--border);
      position:sticky;top:0;z-index:50;
    }
    .topbar .inner{
      max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;justify-content:space-between;padding:14px 20px;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo{width:28px;height:28px;border-radius:6px;background:var(--alcon-blue);box-shadow:inset 0 -8px 16px rgba(255,255,255,.25);}
    .brand span{color:var(--alcon-blue)}
    .crumbs{font-size:12px;color:var(--muted)}
    .avatar{width:32px;height:32px;border-radius:999px;background:linear-gradient(135deg,#c7d2fe,#e0e7ff);display:grid;place-items:center;font-weight:600;color:#334155}

    /* Layout */
    .wrap{max-width:1200px;margin:24px auto 64px;padding:0 20px;}
    .grid{display:grid;grid-template-columns:1.6fr .8fr;gap:20px;align-items:start;}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);}
    .card h3{margin:0 0 8px;font-size:16px}
    .card .sub{font-size:12px;color:var(--muted)}
    .pad{padding:18px}

    .section-title{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:12px}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    select,button,.btn,textarea,input[type="text"]{
      font-family:inherit;font-size:14px;border-radius:12px;border:1px solid var(--border);
      padding:10px 12px;background:#fff;color:var(--text);
    }
    select:focus,textarea:focus,input:focus,button:focus{outline:3px solid rgba(0,114,206,.18)}
    .btn-primary{background:var(--alcon-blue);border-color:var(--alcon-blue);color:#fff;cursor:pointer}
    .btn-primary:hover{background:var(--alcon-blue-600)}
    .btn-outline{background:#fff;color:var(--alcon-blue);border-color:var(--alcon-blue)}

    .dropzone{
      border:2px dashed #cfd8e3;border-radius:12px;padding:24px;display:grid;place-items:center;text-align:center;color:var(--muted);gap:6px
    }
    .dropzone strong{color:var(--text)}

    .textarea{margin-top:12px}
    textarea{width:100%;min-height:120px;resize:vertical}

    .footer-row{display:flex;align-items:center;justify-content:space-between;margin-top:10px;color:var(--muted);font-size:12px}

    /* Placeholder right column on review page */
    .hint{font-size:13px;color:var(--muted);line-height:1.6}
    .hint b{color:#111}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
<style>
/* === Enhancements: non-destructive, uses existing tokens === */
.composer-wrap{
  position: relative;
  border: 1px solid var(--border, #e5e7eb);
  background: var(--surface, #fff);
  border-radius: 16px;
  box-shadow: var(--shadow, 0 8px 30px rgba(0,0,0,.05));
  overflow: hidden;
}
.composer-wrap.dragging{ outline: 2px dashed rgba(0,0,0,.25); outline-offset: -6px; }
.composer-textarea{
  width: 100%; border: 0; resize: vertical; min-height: 180px;
  padding: 14px 16px 18px 16px; background: transparent; font: inherit; color: inherit; line-height: 1.5;
}
.composer-bar{
  display:flex; align-items:center; justify-content:space-between; gap: 8px;
  padding: 10px 12px; border-top: 1px solid var(--border, #e5e7eb); background: var(--surface, #fff);
}
.composer-left{ display:flex; align-items:center; gap:8px; }
.composer-plus{
  display:inline-flex; align-items:center; justify-content:center;
  width: 28px; height: 28px; border-radius: 8px;
  border: 1px solid var(--border, #e5e7eb);
  background: var(--surface, #fff);
  cursor: pointer; user-select: none;
}
.composer-plus:hover{ background: var(--hover, rgba(0,0,0,.04)); }
.composer-plus::before{ content:'+'; font-weight:600; font-size:18px; line-height:1; }
.composer-hint{ color: var(--muted, #6b7280); font-size: 12px; }

/* Combobox */
.combo-wrap{ position: relative; }
.combo-input{
  width: 100%;
  border: 1px solid var(--border, #e5e7eb);
  background: var(--surface, #fff);
  border-radius: 12px;
  padding: 10px 36px 10px 12px;
  font: inherit; color: inherit;
}
.combo-ghost{
  position:absolute; left:12px; right:36px; top:50%; transform:translateY(-50%);
  pointer-events:none; opacity:.45; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  color: var(--muted, #6b7280); font: inherit;
}
.combo-caret{
  position:absolute; right:12px; top:50%; transform: translateY(-50%);
  pointer-events:none;
}
.combo-list{
  position:absolute; z-index:30; left:0; right:0; margin-top:6px;
  max-height:240px; overflow:auto;
  background: var(--surface, #fff);
  border:1px solid var(--border, #e5e7eb);
  border-radius: 12px;
  box-shadow: var(--shadow, 0 8px 30px rgba(0,0,0,.08));
  display:none; padding:6px 0;
}
.combo-list[aria-hidden="false"]{ display:block; }
.combo-list li{ padding:8px 12px; cursor:pointer; }
.combo-list li[aria-selected="true"], .combo-list li:hover{ background: var(--hover, rgba(0,0,0,.04)); }
.helper-line{ color: var(--muted, #6b7280); font-size: 12px; margin-top: 6px; }
</style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="inner">
      <div class="brand" aria-label="Alcon">
        <div class="logo" aria-hidden="true"></div>
        <span>Alcon</span>
        <div class="crumbs">MLR Pre-Screening Agent · Review</div>
      </div>
      <div class="avatar" aria-label="User avatar" title="Sarah Chen">SC</div>
    </div>
  </header>

  <main class="wrap" role="main">
    <div class="grid">
      <!-- LEFT: Content Review -->
      <section class="card pad" aria-labelledby="content-title">
        <div class="section-title">
          <div>
            <h3 id="content-title">Content Review</h3>
            <div class="sub">Upload content or paste text, then analyze against FDA/FTC guidance & approved claims.</div>
          </div>
          <div class="controls">
            <label class="sr-only" for="product">Product</label>
            <select id="product" aria-label="Select product">
              <option>Clareon PanOptix IOL</option>
              <option>Total 30 Contact Lens</option>
            </select>
          </div>
        </div>

        <div class="dropzone" tabindex="0" aria-label="Drag and drop files here" id="drop">
          <div>
            <strong>Drop files here</strong> or click to upload
            <div class="sub">Supports PDF, DOC, DOCX, TXT (max 10MB)</div>
          </div>
        </div>

        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" style="display:none" />

        <div class="textarea">
          <label class="sr-only" for="paste">Paste promotional content</label>
          <textarea id="paste" placeholder="Paste your promotional content here for instant compliance review…"></textarea>
        </div>

        <div class="footer-row">
          <div><span id="charCount">0</span>/5000 characters</div>
          <button class="btn-primary" id="analyze">Analyze Content</button>
        </div>
      </section>

      <!-- RIGHT: Helpful tips -->
      <aside class="card pad">
        <h3>Tips</h3>
        <p class="hint">
          • Keep claims anchored to <b>approved indications</b>.<br>
          • Avoid <b>superiority language</b> unless substantiated.<br>
          • Pair benefits with <b>material risk info</b> and context.<br>
          • Include <b>clear disclaimers</b> and references where needed.
        </p>
      </aside>
    </div>
  </main>

  <script>
    const textarea = document.getElementById('paste');
    const charCount = document.getElementById('charCount');
    const analyzeBtn = document.getElementById('analyze');
    const product = document.getElementById('product');
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileInput');

    textarea.addEventListener('input', () => {
      charCount.textContent = textarea.value.length;
    });

    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('dragover', (e) => { e.preventDefault(); drop.style.borderColor = '#a5b4fc'; });
    drop.addEventListener('dragleave', () => { drop.style.borderColor = '#cfd8e3'; });
    drop.addEventListener('drop', (e) => {
      e.preventDefault();
      drop.style.borderColor = '#cfd8e3';
      const f = e.dataTransfer.files?.[0];
      if (f) {
        localStorage.setItem('mlr_upload_name', f.name);
      }
    });
    fileInput.addEventListener('change', () => {
      if (fileInput.files?.[0]) {
        localStorage.setItem('mlr_upload_name', fileInput.files[0].name);
      }
    });

    analyzeBtn.addEventListener('click', () => {
      const text = textarea.value.trim();
      const prod = product.value;
      localStorage.setItem('mlr_text', text);
      localStorage.setItem('mlr_product', prod);
      window.location.href = 'results.html';
    });
  </script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // ===== Helper line under Content Review title =====
  // Try to find the Content card header and inject a professional helper line.
  (function injectHelperLine(){
    // Heuristic: find a header element that labels the main content area containing the textarea#paste
    const textarea = document.getElementById('paste');
    if (!textarea) return;
    let card = textarea.closest('.card');
    if (!card) return;
    const hd = card.querySelector('.hd') || card.querySelector('header, .header');
    if (!hd) return;
    // Create or update helper
    let help = hd.querySelector('#contentHelpLine');
    if (!help){
      help = document.createElement('div');
      help.id = 'contentHelpLine';
      help.className = 'helper-line';
      hd.appendChild(help);
    }
    help.textContent = 'Begin reviewing content against compliance standards to prepare for MLR Official Review.';
  })();

  // ===== ChatGPT-style composer for the existing #paste =====
  (function upgradeComposer(){
    const textarea = document.getElementById('paste');
    if (!textarea) return;
    const charCount = document.getElementById('charCount');
    const analyze   = document.getElementById('analyze');
    const dropZone  = document.getElementById('drop'); // hide old drop area if present
    if (dropZone) dropZone.style.display = 'none';

    // Reuse existing hidden file input if available or create one
    let fileInput = document.getElementById('fileInput');
    if (!fileInput){
      fileInput = document.createElement('input');
      fileInput.type = 'file'; fileInput.id = 'fileInput';
      fileInput.accept = '.txt,.doc,.docx,.pdf,.rtf,.md,.html,.csv';
      fileInput.style.display = 'none';
      textarea.parentNode.insertBefore(fileInput, textarea);
    }

    // Wrap textarea
    const wrap = document.createElement('div');
    wrap.className = 'composer-wrap';

    textarea.classList.add('composer-textarea');
    textarea.placeholder = 'Type, paste, or drag and drop content here…';

    const bar = document.createElement('div');
    bar.className = 'composer-bar';

    const left = document.createElement('div');
    left.className = 'composer-left';

    const plus = document.createElement('button');
    plus.type = 'button';
    plus.className = 'composer-plus';
    plus.title = 'Upload a file'; plus.setAttribute('aria-label','Upload a file');
    plus.addEventListener('click', ()=> fileInput.click());
    left.appendChild(plus);

    const hint = document.createElement('span');
    hint.className = 'composer-hint';
    hint.textContent = 'Upload file';
    left.appendChild(hint);

    const right = document.createElement('div');
    // Create a count element if not present
    let countNode = charCount;
    if (!countNode){
      countNode = document.createElement('span');
      countNode.id = 'charCount';
      countNode.className = 'composer-hint';
    }
    countNode.setAttribute('aria-live','polite');
    countNode.setAttribute('aria-atomic','true');
    right.appendChild(countNode);

    bar.appendChild(left);
    bar.appendChild(right);

    // Insert DOM
    const parent = textarea.parentNode;
    parent.insertBefore(wrap, textarea);
    wrap.appendChild(textarea);
    wrap.appendChild(bar);

    // Drag & drop on wrap
    function addDnDHandlers(el){
      ['dragenter','dragover'].forEach(evt => el.addEventListener(evt, e => {
        e.preventDefault(); e.stopPropagation();
        wrap.classList.add('dragging');
      }));
      ['dragleave','drop'].forEach(evt => el.addEventListener(evt, e => {
        e.preventDefault(); e.stopPropagation();
        wrap.classList.remove('dragging');
      }));
      el.addEventListener('drop', async (e) => {
        const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        await handleFile(f);
      });
    }
    addDnDHandlers(wrap);

    // Ingest files
    async function handleFile(file){
      if (!file) return;
      try { localStorage.setItem('mlr_upload_name', file.name); } catch {}
      if (/\.txt$/i.test(file.name)){
        const text = await file.text();
        textarea.value = text;
        try { localStorage.setItem('mlr_text', text); } catch {}
        updateCount();
      }
    }
    fileInput.addEventListener('change', async ()=>{
      const f = fileInput.files && fileInput.files[0];
      await handleFile(f);
    });

    // Live count + analyze button state
    function updateCount(){
      const n = (textarea.value || '').length;
      countNode.textContent = n + ' characters';
      if (analyze){
        analyze.disabled = n === 0;
        analyze.setAttribute('aria-disabled', String(n === 0));
        analyze.type = 'button';
      }
    }
    textarea.addEventListener('input', ()=>{
      try { localStorage.setItem('mlr_text', textarea.value); } catch {}
      updateCount();
    });
    updateCount();
  })();

  // ===== Product combobox in same spot as existing <select id="product"> =====
  (function productCombobox(){
    const sel = document.getElementById('product');
    if (!sel) return;

    // Build wrapper before the select, so it occupies the exact same place
    const wrap = document.createElement('div');
    wrap.className = 'combo-wrap';
    wrap.setAttribute('role','combobox');
    wrap.setAttribute('aria-haspopup','listbox');
    wrap.setAttribute('aria-expanded','false');
    wrap.setAttribute('aria-owns','product-listbox');

    const input = document.createElement('input');
    input.id = 'productInput';
    input.className = 'combo-input';
    input.type = 'text'; input.autocomplete = 'off';
    input.placeholder = 'Select Product…';
    input.setAttribute('aria-autocomplete','both'); input.setAttribute('aria-controls','product-listbox');

    const ghost = document.createElement('div');
    ghost.id = 'productGhost'; ghost.className = 'combo-ghost'; ghost.setAttribute('aria-hidden','true');

    const caret = document.createElement('div');
    caret.className = 'combo-caret'; caret.innerHTML = '&#9662;'; // ▼

    const list = document.createElement('ul');
    list.id = 'product-listbox'; list.className = 'combo-list';
    list.setAttribute('role','listbox'); list.setAttribute('aria-hidden','true');

    sel.parentNode.insertBefore(wrap, sel);
    wrap.appendChild(input); wrap.appendChild(ghost); wrap.appendChild(caret); wrap.appendChild(list);

    // Hide the original select but keep in DOM for scripts relying on it
    sel.style.display = 'none';

    // Build product array from select options
    const PRODUCTS = [];
    for (const opt of sel.options){ if (opt.text) PRODUCTS.push(opt.text.trim()); }

    // Hydrate from storage
    try {
      const stored = localStorage.getItem('mlr_product');
      if (stored) input.value = stored;
    } catch {}

    function norm(s){ return (s||'').toLowerCase().normalize('NFKD'); }
    function filter(q){
      const nq = norm(q);
      if (!nq) return PRODUCTS.slice(0,50);
      const starts = [], contains = [];
      for (const p of PRODUCTS){
        const np = norm(p);
        if (np.startsWith(nq)) starts.push(p);
        else if (np.includes(nq)) contains.push(p);
      }
      return starts.concat(contains).slice(0,50);
    }
    function setExpanded(open){
      wrap.setAttribute('aria-expanded', String(!!open));
      list.setAttribute('aria-hidden', String(!open));
    }
    function render(items, active = -1){
      list.innerHTML='';
      items.forEach((label,i)=>{
        const li = document.createElement('li');
        li.role='option'; li.id='product-opt-'+i; li.textContent=label;
        if (i===active) li.setAttribute('aria-selected','true');
        li.addEventListener('mousedown',(e)=>{ e.preventDefault(); commit(label); });
        list.appendChild(li);
      });
      setExpanded(items.length>0);
    }
    function updateGhost(pred){
    if (document.activeElement !== input || !input.value) { ghost.textContent=''; return; }
      const q = input.value;
      if (!q || !pred || norm(pred).indexOf(norm(q)) !== 0){ ghost.textContent=''; return; }
      ghost.textContent = q + pred.slice(q.length);
    }
    function commit(value){
      input.value = value; ghost.textContent='';
      // sync to select for any dependent code
      for (let i=0;i<sel.options.length;i++){
        if (sel.options[i].text.trim()===value){ sel.selectedIndex=i; break; }
      }
      try { localStorage.setItem('mlr_product', value); } catch {}
      setExpanded(false);
    }

    let items = filter(input.value), active = -1;
    function refresh(){ items = filter(input.value); active=-1; render(items,active); updateGhost(items[0]); }
    refresh();

    input.addEventListener('focus', ()=>{ refresh(); if (items.length) setExpanded(true); });
    input.addEventListener('input', refresh);
    input.addEventListener('keydown',(e)=>{
      const k = e.key;
      if (k==='ArrowDown'){ e.preventDefault(); if (!items.length) return; active=(active+1)%items.length; render(items,active); updateGhost(items[0]); }
      else if (k==='ArrowUp'){ e.preventDefault(); if (!items.length) return; active=(active-1+items.length)%items.length; render(items,active); updateGhost(items[0]); }
      else if (k==='Enter'){
        if (active>=0 && items[active]){ e.preventDefault(); commit(items[active]); }
        else if (items[0]){ e.preventDefault(); commit(items[0]); }
      } else if (k==='Tab'){
        if (ghost.textContent && items[0]) commit(items[0]);
      } else if (k==='Escape'){ setExpanded(false); active=-1; }
    });
    document.addEventListener('click',(e)=>{ if (!wrap.contains(e.target)) setExpanded(false); });
    caret.addEventListener('click',(e)=>{ e.stopPropagation(); if (list.getAttribute('aria-hidden')==='true'){ refresh(); setExpanded(true); input.focus(); } else setExpanded(false); });
  })();
});
</script>


<script>
(function enhanceDnDAndFilenameBadge(){
  const fileInput = document.getElementById('fileInput');
  const textarea  = document.getElementById('paste');
  // Add a filename badge next to the character count
  let countNode = document.getElementById('charCount');
  const bar = textarea ? textarea.parentElement && textarea.parentElement.querySelector('.composer-bar') : null;
  if (bar){
    let right = bar.lastElementChild;
    if (right){
      const badge = document.createElement('span');
      badge.id = 'fileBadge';
      badge.style.marginRight = '10px';
      badge.style.fontSize = '12px';
      badge.style.color = 'var(--muted, #6b7280)';
      badge.textContent = '';
      right.prepend(badge);
      // hydrate from storage
      try {
        const fname = localStorage.getItem('mlr_upload_name') || '';
        if (fname) badge.textContent = fname;
      } catch {}
    }
  }
  function setFileNameBadge(name){
    const badge = document.getElementById('fileBadge');
    if (badge) badge.textContent = name || '';
  }
  async function handleFileEnhanced(file){
    if (!file) return;
    try { localStorage.setItem('mlr_upload_name', file.name); } catch {}
    setFileNameBadge(file.name);
    // .txt -> ingest to textarea, others leave text intact
    if (/\.txt$/i.test(file.name)){
      const text = await file.text();
      textarea.value = text;
      try { localStorage.setItem('mlr_text', text); } catch {}
      // Update count if present
      const cc = document.getElementById('charCount');
      if (cc) cc.textContent = (text || '').length + ' characters';
    }
    // If there's an explicit filename input, keep it in sync
    const fileNameInput = document.getElementById('fileName');
    if (fileNameInput){
      fileNameInput.value = file.name;
      try { localStorage.setItem('mlr_upload_name', file.name); } catch {}
    }
  }
  // Wire to existing change handler
  if (fileInput){
    const prev = fileInput.onchange;
    fileInput.onchange = async function(e){
      if (prev) prev.call(this, e);
      const f = this.files && this.files[0];
      await handleFileEnhanced(f);
    };
  }
  // Global drag-over and drop (to ensure drop works reliably)
  ['dragenter','dragover','dragleave','drop'].forEach(evt => {
    window.addEventListener(evt, function(e){
      if (evt==='dragenter' || evt==='dragover'){
        e.preventDefault();
      } else if (evt==='drop'){
        e.preventDefault();
        const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        handleFileEnhanced(f);
      }
    });
  });
})();
</script>

</body>
</html>

<!-- Persist inputs & expand drag/drop WITHOUT changing styles -->
<script>
(function enhanceReview(){
  try{
    const textarea  = document.getElementById('paste');
    const charCount = document.getElementById('charCount');
    const product   = document.getElementById('product');
    const fileInput = document.getElementById('fileInput');
    const drop      = document.getElementById('drop');
    const card      = document.querySelector('section.card.pad[aria-labelledby="content-title"]') || document.querySelector('section.card.pad');

    // Rehydrate saved state on load
    const savedText = localStorage.getItem('mlr_text') || '';
    const savedProd = localStorage.getItem('mlr_product');
    if (textarea){ textarea.value = savedText; if (charCount) charCount.textContent = textarea.value.length; }
    if (product && savedProd){ product.value = savedProd; }

    // Save on every change
    if (textarea){
      textarea.addEventListener('input', () => {
        if (charCount) charCount.textContent = textarea.value.length;
        localStorage.setItem('mlr_text', textarea.value);
      });
    }
    if (product){
      product.addEventListener('change', () => {
        localStorage.setItem('mlr_product', product.value);
      });
    }

    // Expand drag/drop to the whole card to feel chat-like (aesthetic unchanged)
    if (card && drop){
      ['dragover','dragenter'].forEach(ev =>
        card.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor = '#a5b4fc'; })
      );
      ['dragleave','drop'].forEach(ev =>
        card.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor = '#cfd8e3'; })
      );
      card.addEventListener('drop', (e) => {
        const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        if (f) { localStorage.setItem('mlr_upload_name', f.name); }
      });
    }

    // Also persist filename on manual attach
    if (fileInput){
      fileInput.addEventListener('change', () => {
        if (fileInput.files && fileInput.files[0]) {
          localStorage.setItem('mlr_upload_name', fileInput.files[0].name);
        }
      });
    }
  }catch(e){ console.warn('enhanceReview error', e); }
})();
</script>
