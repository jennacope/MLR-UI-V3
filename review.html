<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alcon MLR Pre-Screening Agent – Review</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --alcon-blue:#0072CE;
      --alcon-blue-600:#035bb0;
      --bg:#F6F8FB;
      --text:#1F2937;
      --muted:#6B7280;
      --card:#FFFFFF;
      --border:#E5E7EB;
      --shadow:0 10px 20px rgba(16,24,40,.06),0 2px 6px rgba(16,24,40,.06);
      --green:#12B76A;
      --amber:#FEC84B;
      --red:#D92D20;
      --teal:#2DD4BF;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--bg);
      line-height:1.45;
    }
    /* Top bar */
    .topbar{
      background:var(--card);
      border-bottom:1px solid var(--border);
      position:sticky;top:0;z-index:50;
    }
    .topbar .inner{
      max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:16px;justify-content:space-between;padding:14px 20px;
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .logo{width:28px;height:28px;border-radius:6px;background:var(--alcon-blue);box-shadow:inset 0 -8px 16px rgba(255,255,255,.25);}
    .brand span{color:var(--alcon-blue)}
    .crumbs{font-size:12px;color:var(--muted)}
    .avatar{width:32px;height:32px;border-radius:999px;background:linear-gradient(135deg,#c7d2fe,#e0e7ff);display:grid;place-items:center;font-weight:600;color:#334155}

    /* Layout */
    .wrap{max-width:1200px;margin:24px auto 64px;padding:0 20px;}
    .grid{display:grid;grid-template-columns:1.6fr .8fr;gap:20px;align-items:start;}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);}
    .card h3{margin:0 0 8px;font-size:16px}
    .card .sub{font-size:12px;color:var(--muted)}
    .pad{padding:18px}

    .section-title{display:flex;align-items:baseline;justify-content:space-between;margin-bottom:12px}
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    select,button,.btn,textarea,input[type="text"]{
      font-family:inherit;font-size:14px;border-radius:12px;border:1px solid var(--border);
      padding:10px 12px;background:#fff;color:var(--text);
    }
    select:focus,textarea:focus,input:focus,button:focus{outline:3px solid rgba(0,114,206,.18)}
    .btn-primary{background:var(--alcon-blue);border-color:var(--alcon-blue);color:#fff;cursor:pointer}
    .btn-primary:hover{background:var(--alcon-blue-600)}
    .btn-outline{background:#fff;color:var(--alcon-blue);border-color:var(--alcon-blue)}

    .dropzone{
      border:2px dashed #cfd8e3;border-radius:12px;padding:24px;display:grid;place-items:center;text-align:center;color:var(--muted);gap:6px
    }
    .dropzone strong{color:var(--text)}

    .textarea{margin-top:12px}
    textarea{width:100%;min-height:120px;resize:vertical}

    .footer-row{display:flex;align-items:center;justify-content:space-between;margin-top:10px;color:var(--muted);font-size:12px}

    /* Placeholder right column on review page */
    .hint{font-size:13px;color:var(--muted);line-height:1.6}
    .hint b{color:#111}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="inner">
      <div class="brand" aria-label="Alcon">
        <div class="logo" aria-hidden="true"></div>
        <span>Alcon</span>
        <div class="crumbs">MLR Pre-Screening Agent · Review</div>
      </div>
      <div class="avatar" aria-label="User avatar" title="Sarah Chen">SC</div>
    </div>
  </header>

  <main class="wrap" role="main">
    <div class="grid">
      <!-- LEFT: Content Review -->
      <section class="card pad" aria-labelledby="content-title">
        <div class="section-title">
          <div>
            <h3 id="content-title">Content Review</h3>
            <div class="sub">Upload content or paste text, then analyze against FDA/FTC guidance & approved claims.</div>
          </div>
          <div class="controls">
            <label class="sr-only" for="product">Product</label>
            <select id="product" aria-label="Select product">
              <option>Clareon PanOptix IOL</option>
              <option>Total 30 Contact Lens</option>
            </select>
          </div>
        </div>

        <div class="dropzone" tabindex="0" aria-label="Drag and drop files here" id="drop">
          <div>
            <strong>Drop files here</strong> or click to upload
            <div class="sub">Supports PDF, DOC, DOCX, TXT (max 10MB)</div>
          </div>
        </div>

        <input type="file" id="fileInput" accept=".pdf,.doc,.docx,.txt" style="display:none" />

        <div class="textarea">
          <label class="sr-only" for="paste">Paste promotional content</label>
          <textarea id="paste" placeholder="Type, paste, or drag and drop content here…"></textarea>
        </div>

        <div class="footer-row">
          <div><span id="charCount">0</span>/5000 characters</div>
          <button class="btn-primary" id="analyze">Analyze Content</button>
        </div>
      </section>

      <!-- RIGHT: Helpful tips -->
      <aside class="card pad">
        <h3>Tips</h3>
        <p class="hint">
          • Keep claims anchored to <b>approved indications</b>.<br>
          • Avoid <b>superiority language</b> unless substantiated.<br>
          • Pair benefits with <b>material risk info</b> and context.<br>
          • Include <b>clear disclaimers</b> and references where needed.
        </p>
      </aside>
    </div>
  </main>

  <script>
    const textarea = document.getElementById('paste');
    const charCount = document.getElementById('charCount');
    const analyzeBtn = document.getElementById('analyze');
    const product = document.getElementById('product');
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileInput');

    textarea.addEventListener('input', () => {
      charCount.textContent = textarea.value.length;
    });

    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('dragover', (e) => { e.preventDefault(); drop.style.borderColor = '#a5b4fc'; });
    drop.addEventListener('dragleave', () => { drop.style.borderColor = '#cfd8e3'; });
    drop.addEventListener('drop', (e) => {
      e.preventDefault();
      drop.style.borderColor = '#cfd8e3';
      const f = e.dataTransfer.files?.[0];
      if (f) {
        localStorage.setItem('mlr_upload_name', f.name);
      }
    });
    fileInput.addEventListener('change', () => {
      if (fileInput.files?.[0]) {
        localStorage.setItem('mlr_upload_name', fileInput.files[0].name);
      }
    });

    analyzeBtn.addEventListener('click', () => {
      const text = textarea.value.trim();
      const prod = product.value;
      localStorage.setItem('mlr_text', text);
      localStorage.setItem('mlr_product', prod);
      window.location.href = 'results.html';
    });
  </script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // ====== Clean start unless share hash present ======
  const hasShare = new URLSearchParams(location.hash.slice(1)).has('s');
  if (!hasShare) {
    try { localStorage.removeItem('mlr_upload_name'); } catch {}
  }

  const textarea = document.getElementById('paste');
  const drop     = document.getElementById('drop');
  const fileInput= document.getElementById('fileInput');
  const analyze  = document.getElementById('analyze');

  if (!textarea) return;
  textarea.placeholder = "Type, paste, or drag and drop content here…";

  // ====== Live counter merge into bottom-left "/5000 characters" ======
  (function mergeCounterToBottom(){
    function findLimitNode(){
      const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, null);
      let node, el;
      while ((node = walker.nextNode())){
        if (/\s*\/\s*5000\s*characters/i.test(node.textContent || '')) { el = node.parentElement; break; }
      }
      if (el) el.id = 'limitCounter';
      return el;
    }
    const limitEl = findLimitNode();
    function update(){
      const n = (textarea.value || '').length;
      if (limitEl) limitEl.textContent = n + ' / 5000 characters';
      if (analyze){ analyze.disabled = n===0; analyze.setAttribute('aria-disabled', String(n===0)); analyze.type='button'; }
    }
    update();
    textarea.addEventListener('input', update);
  })();

  // ====== Add a clean "Remove file" link next to the upload hint ======
  let removeLink = document.createElement('button');
  removeLink.type = 'button';
  removeLink.textContent = 'Remove file';
  removeLink.style.marginLeft = '8px';
  removeLink.style.textDecoration = 'underline';
  removeLink.style.background = 'transparent';
  removeLink.style.border = '0';
  removeLink.style.cursor = 'pointer';
  removeLink.style.fontSize = '12px';
  removeLink.style.color = 'var(--muted)';
  removeLink.id = 'removeFileLink';
  removeLink.hidden = true;

  (function placeRemoveLink(){
    if (!drop) return;
    const sub = drop.querySelector('.sub');
    if (sub && sub.parentNode){ sub.parentNode.appendChild(removeLink); }
    else { drop.appendChild(removeLink); }
  })();

  // ====== File handling (single source of truth) ======
  let lastUpload = null; // {name, wasTxt, previousText}

  async function handleFile(file){
    if (!file) return;
    const prevText = textarea.value || '';
    const wasTxt = /\.txt$/i.test(file.name);

    // Persist filename
    try { localStorage.setItem('mlr_upload_name', file.name); } catch {}

    if (wasTxt){
      const text = await file.text();
      textarea.value = text;
    } else {
      // Insert natural marker at TOP; replace existing top marker if present
      const marker = "Attached file: " + file.name;
      const current = textarea.value || "";
      const lines = current.split(/\r?\n/);
      if (lines.length && /^Attached file: /.test(lines[0])) {
        lines[0] = marker;
        textarea.value = lines.join("\\n");
      } else {
        textarea.value = marker + "\\n\\n" + current;
      }
    }

    try { localStorage.setItem('mlr_text', textarea.value); } catch {}
    textarea.dispatchEvent(new Event('input', { bubbles: true }));

    // Remember for removal
    lastUpload = { name: file.name, wasTxt, previousText: prevText };
    removeLink.hidden = false;
  }

  // Wire existing drop zone
  if (drop){
    // Ensure we capture drop correctly
    drop.addEventListener('dragover', e => { e.preventDefault(); });
    drop.addEventListener('drop', async (e) => {
      e.preventDefault();
      const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if (f) await handleFile(f);
    });
  }

  // Wire file input
  if (fileInput){
    fileInput.addEventListener('change', async () => {
      const f = fileInput.files && fileInput.files[0];
      if (f) await handleFile(f);
    });
  }

  // ====== Remove file behavior ======
  function removeInlineMarkerByName(filename){
    if (!filename) return;
    const marker = "Attached file: " + filename;
    const current = textarea.value || "";
    if (current.startsWith(marker)){
      // Remove first line and any following blank line
      const pattern = new RegExp("^" + marker.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&') + "(?:\\r?\\n)?(?:\\r?\\n)?");
      const next = current.replace(pattern, '');
      if (next !== current){
        textarea.value = next;
        try { localStorage.setItem('mlr_text', textarea.value); } catch {}
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
      }
    }
  }

  removeLink.addEventListener('click', () => {
    const fname = (lastUpload && lastUpload.name) || (function(){ try { return localStorage.getItem('mlr_upload_name') || ''; } catch { return ''; } })();
    try { localStorage.removeItem('mlr_upload_name'); } catch {}
    if (lastUpload && lastUpload.wasTxt && typeof lastUpload.previousText === 'string'){
      const restore = confirm('Remove uploaded text and restore what was in the box before the .txt upload?');
      if (restore){
        textarea.value = lastUpload.previousText;
        try { localStorage.setItem('mlr_text', textarea.value); } catch {}
        textarea.dispatchEvent(new Event('input', { bubbles: true }));
      } else {
        // If not restoring, just clear whatever is there
        // (No extra handling needed)
      }
    } else {
      removeInlineMarkerByName(fname);
    }
    removeLink.hidden = true;
  });
});
</script>

</body>
</html>

<!-- Persist inputs & expand drag/drop WITHOUT changing styles -->
<script>
(function enhanceReview(){
  try{
    const textarea  = document.getElementById('paste');
    const charCount = document.getElementById('charCount');
    const product   = document.getElementById('product');
    const fileInput = document.getElementById('fileInput');
    const drop      = document.getElementById('drop');
    const card      = document.querySelector('section.card.pad[aria-labelledby="content-title"]') || document.querySelector('section.card.pad');

    // Rehydrate saved state on load
    const savedText = localStorage.getItem('mlr_text') || '';
    const savedProd = localStorage.getItem('mlr_product');
    if (textarea){ textarea.value = savedText; if (charCount) charCount.textContent = textarea.value.length; }
    if (product && savedProd){ product.value = savedProd; }

    // Save on every change
    if (textarea){
      textarea.addEventListener('input', () => {
        if (charCount) charCount.textContent = textarea.value.length;
        localStorage.setItem('mlr_text', textarea.value);
      });
    }
    if (product){
      product.addEventListener('change', () => {
        localStorage.setItem('mlr_product', product.value);
      });
    }

    // Expand drag/drop to the whole card to feel chat-like (aesthetic unchanged)
    if (card && drop){
      ['dragover','dragenter'].forEach(ev =>
        card.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor = '#a5b4fc'; })
      );
      ['dragleave','drop'].forEach(ev =>
        card.addEventListener(ev, e => { e.preventDefault(); drop.style.borderColor = '#cfd8e3'; })
      );
      card.addEventListener('drop', (e) => {
        const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
        if (f) { localStorage.setItem('mlr_upload_name', f.name); }
      });
    }

    // Also persist filename on manual attach
    if (fileInput){
      fileInput.addEventListener('change', () => {
        if (fileInput.files && fileInput.files[0]) {
          localStorage.setItem('mlr_upload_name', fileInput.files[0].name);
        }
      });
    }
  }catch(e){ console.warn('enhanceReview error', e); }
})();
</script>
